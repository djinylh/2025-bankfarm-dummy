<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "com.bankfarm_dummy.bankfarm_dummy.loan.LoanRepaymentMapper">

    <insert id="loanRepaymentInsert">
        INSERT INTO loan_repayment
        SET loan_id = #{loanId}
        ,   loan_rpmt_due = #{loanRpmtDue}
        ,   loan_rpmt_prncp = #{loanRpmtPrncp}
        ,   loan_rpmt_intrst = #{loanRpmtIntrst}
        ,   loan_due_dt = #{loanDueDt}
        ,   loan_due_sts = #{loanDueSts}
    </insert>

    <select id="GetLoanInfoByLoanId">
        SELECT l.loan_id, la.loan_dcsn_dt, la.loan_req_amt, la.loan_req_trm, l.loan_fn_intrst
        FROM loan l
        JOIN loan_application la
        ON l.loan_app_id = la.loan_app_id
        WHERE l.loan_id = #{loanId}
    </select>

    <select id="getByTx007">
        SELECT a.loan_id, a.loan_rpmt_id, a.loan_rpmt_due, a.loan_due_dt, a.loan_rpmt_intrst, b.rt_pct
        FROM (SELECT DISTINCT lr.loan_id, lr.loan_rpmt_id, lr.loan_rpmt_due, lr.loan_due_dt, lr.loan_rpmt_intrst
        FROM loan_repayment lr
        WHERE lr.loan_due_sts = 'TX007'
        AND lr.loan_id IN (SELECT p.prod_id
        FROM prod_rate p
        WHERE p.prod_tp = 'RT007')) AS a
        LEFT JOIN
        (SELECT DISTINCT pr.prod_id, rr.rt_id,rr.rt_rule, rr.rt_pct
        FROM prod_rate pr
        LEFT JOIN rate_rule rr
        ON pr.prod_rt_id = rr.rt_id
        WHERE rr.rt_tp = 'RT002') AS b
        ON a.loan_id = b.prod_id
    </select>

</mapper>